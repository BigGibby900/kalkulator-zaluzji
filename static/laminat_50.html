<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Żaluzje Laminat 50MM</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Żaluzje Laminat 50MM</h1>
        <nav>
            <a href="index.html">Strona Główna</a>
        </nav>
    </header>
    
    <main>
        <h2>Kalkulator cen</h2>

        <div id="inputs-container">
            <div class="input-pair">
                <label for="width1">Szerokość (cm):</label>
                <input type="number" id="width1" placeholder="Wpisz szerokość" required>

                <label for="height1">Wysokość (cm):</label>
                <input type="number" id="height1" placeholder="Wpisz wysokość" required>

                <label for="zybka1">Prowadzenie żyłki:</label>
                <select id="zybka1">
                    <option value="0">Brak (0 zł)</option>
                    <option value="25">Prowadzenie żyłki 25 (35 zł)</option>
                    <option value="50">Prowadzenie żyłki 50 (50 zł)</option>
                </select>

                <label for="karnisz1">Karnisz:</label>
                <select id="karnisz1">
                    <option value="0">Nie (0 zł)</option>
                    <option value="30">Tak (30 zł)</option>
                </select>
            </div>
        </div>

        <button onclick="addInputs()">Dodaj kolejną parę wymiarów</button>

        <button onclick="calculatePrice()">Sprawdź ceny</button>
        
        <p id="result"></p>
    </main>

    <script>
        let counter = 1;

        function addInputs() {
            counter++;
            const container = document.getElementById("inputs-container");

            const newPair = document.createElement("div");
            newPair.classList.add("input-pair");
            newPair.innerHTML = `
                <label for="width${counter}">Szerokość (cm):</label>
                <input type="number" id="width${counter}" placeholder="Wpisz szerokość" required>

                <label for="height${counter}">Wysokość (cm):</label>
                <input type="number" id="height${counter}" placeholder="Wpisz wysokość" required>

                <label for="zybka${counter}">Prowadzenie żyłki:</label>
                <select id="zybka${counter}">
                    <option value="0">Brak (0 zł)</option>
                    <option value="25">Prowadzenie żyłki 25 (35 zł)</option>
                    <option value="50">Prowadzenie żyłki 50 (50 zł)</option>
                </select>

                <label for="karnisz${counter}">Karnisz:</label>
                <select id="karnisz${counter}">
                    <option value="0">Nie (0 zł)</option>
                    <option value="30">Tak (30 zł)</option>
                </select>
            `;
            container.appendChild(newPair);
        }

        function calculatePrice() {
            const category = "laminat_50";  // Zmieniona kategoria na Laminat 50MM
            let widths = [];
            let heights = [];
            let zybkaOptions = [];
            let karniszOptions = [];

            for (let i = 1; i <= counter; i++) {
                const width = document.getElementById(`width${i}`).value;
                const height = document.getElementById(`height${i}`).value;

                if (!width || !height) {
                    document.getElementById("result").innerText = "Wprowadź wszystkie szerokości i wysokości!";
                    return;
                }

                widths.push(width);
                heights.push(height);

                const prowadzenieZylki = document.getElementById(`zybka${i}`).value;
                const karnisz = document.getElementById(`karnisz${i}`).value;

                zybkaOptions.push(prowadzenieZylki);
                karniszOptions.push(karnisz);
            }

            // Zaktualizowany URL do backendu
            const url = `https://kalkulator-zaluzji.onrender.com/cena/?category=${category}` +
                        widths.map((w, i) => `&szerokosci=${w}`).join('') + 
                        heights.map((h, i) => `&wysokosci=${h}`).join('') + 
                        zybkaOptions.map((z, i) => `&zybka${i + 1}=${z}`).join('') + 
                        karniszOptions.map((k, i) => `&karnisz${i + 1}=${k}`).join('');

            // Wysyłanie zapytania do backendu
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById("result").innerText = "Błąd: " + data.error;
                    } else {
                        let totalPrice = 0;
                        let resultText = "Ceny:\n";

                        data.results.forEach(item => {
                            if (item.error) {
                                resultText += `Błąd dla wymiarów ${item.szerokosc}x${item.wysokosc}: ${item.error}\n`;
                            } else {
                                resultText += `Cena dla ${item.szerokosc}x${item.wysokosc}: ${item.cena} zł (zaokrąglone do: ${item.zaokraglona_szerokosc}x${item.zaokraglona_wysokosc})\n`;
                                totalPrice += item.cena;
                            }
                        });

                        resultText += `\nŁączna cena: ${totalPrice} zł`;
                        document.getElementById("result").innerText = resultText;
                    }
                })
                .catch(error => {
                    document.getElementById("result").innerText = "Błąd połączenia z serwerem.";
                    console.error("Błąd pobierania danych:", error);
                });
        }
    </script>
</body>
</html>
